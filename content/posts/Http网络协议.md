---
title: "Http网络协议"
date: 2020-07-22T14:20:27+08:00
categories: ["编程 · 技术"]
tags: ["基础知识"]
draft: false
---

根据阅读书籍《图解HTTP》总结的笔记，图片来源《图解HTTP》黑白版pdf

# 一、了解Web和网络基础

**Web是建立在Http协议上通信的。**

TCP/IP协议：

| 应用层                                                       | 传输层                                                       | 网络层（网络互联层）                                         | 链路层（数据链路层、网络接口层） |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------- |
| 向用户提供应用服务时通信的活动。                             | 对应用层提供处于两台计算机之间的数据传输                     | 处理在网络上流动的数据包。数据包是网络传输的最小单位。       | 处理连接网络的硬件部分。         |
| TCP/IP协议族内预存了各类通用的应用服务，比如FTP(文件传输协议)和DNS（域名系统）服务就是其中两类。 | 两个不同性质的协议: TCP（传输控制协议）和UDP(用户数据报协议) | 规定了通过怎么样的路径（所谓的传输路线）到达对方的电脑，把数据包传给对方 |                                  |
| HTTP协议也处于这层                                           |                                                              | 作用就是在众多选项内选择一条传输路线。                       |                                  |

**TCP/IP通信传输流**

![htpp1](/images/assets/http1.png)



## 与HTTP关系密切的协议：IP、TCP和DNS

#### 一、负责传输的IP协议

- IP网际协议位于网络层，作用是把各种数据包传送给对方。

- 确保确实传送到对方需要满足各类条件，其中两个重要条件是IP地址和MAC地址。

- IP地址：指明了节点被分配的地址，

  MAC地址：指网卡所属的固定地址。

- IP地址可以和MAC地址进行配对。

- IP地址可变换，但MAC地址基本上不会更改。



- 使用ARP协议凭借MAC地址进行通信：

  ARP地址是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。



#### 二、确保可靠性的TCP协议

TCP属于传输层，提供可靠的字节流服务。

字节流服务：为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理。

**确保数据能够到达目标**

为了让数据准确无误的到达目标，采用**三次握手策略**

TCP的标志：SYN和ACK

1.发送带有SYN标志数据包给对方

2.对方收到后，回复一个带SYN/ACK标志的包以表达确认信息

3.最后发送一个带有ACK的包，表示"握手"结束



#### 三、负责域名解析的DNS

- DNS服务是和HTTP协议一样位于应用层的协议，它提供域名到IP地址之间的解析服务。

- DNS协议提供通过域名查找IP地址，或者从IP地址反查域名的服务。




**结合几种协议形成的流程图**

![http2](/images/assets/http2.png)

## URL和URI

- URL：使用Web浏览器访问Web页面时需要输入的网页地址

- URI：由某个协议方案表示的资源的定位标识符。


URI用标识某一互联网资源，而URL表示资源地点。所以URL就是URI的子集。

**URI格式**

![htpp3](/images/assets/http3.png)



# 二、简单的HTTP协议

HTTP协议：用于客户端和服务器之间的通信

请求报文是由请求方法、请求URL、协议版本、可选的请求首部字段和内容实体构成的。

![http4](/images/assets/http4.png)

回响报文：协议版本、状态码、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

![http5](/images/assets/http5.png)

**HTTP是不保存状态的协议**，即无状态协议。

协议本身并不保留之前一切的请求或响应报文的信息。目的是为了更快地处理大量事务，确保协议的可伸缩性。

HTTP/1.1虽然是无状态协议，但是为了实现期望的保持状态功能，引入了Cookie技术。



**告知服务器意图的HTTP方法**

| GET:获取资源                             | POST：传输实体主题 | PUT：传输文件                                                | HEAD:获取报文首部                            |
| ---------------------------------------- | ------------------ | ------------------------------------------------------------ | -------------------------------------------- |
| 请求访问已被URL识别的资源。              | 用于传输实体的主体 | 用于传输文件                                                 | 请求访问已被URL识别的资源，但只返回报文首部  |
| 指定的资源经服务器端解析后返回回响内容。 |                    | 要求在请求报文的主题中包含文件内容，然后保存到请求URL指定的位置。 | 用于确认URI的有效性及资源 更新的日期时间等。 |
|                                          |                    | 缺点：鉴于HTTP/1.1 的PUT方法自身不带检验功能，任何人都能上传文件，存在安全性问题。 |                                              |



| DELETE：删除文件                                             | OPTIONS：询问支持方法                                | TRACE：追踪路径                                 | CONNECT:要求用隧道协议连接代理                               |
| ------------------------------------------------------------ | ---------------------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------ |
| 与PUT方法相反，DELETE请求URI删除指定的资源。                 | OPTIONS方法用于查询针对请求URI指定的资源支持的方法。 | 让web服务器将之前的请求通信返回给客户端的方法、 | 要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信  |
| 缺点：鉴于HTTP/1.1 的PUT方法自身不带检验功能，任何人都能删除文件，存在安全性问题。 |                                                      | 可以查询发送出去的请求是怎么被家工篡改/修改的   | 用SSL（安全套接层）和TLS（传输层安全）协议把通信内容加密后经网络隧道传输 |
|                                                              |                                                      | 缺点：容易引起XST（跨站攻击)                    |                                                              |



### 持久连接节省通信量

**持续连接**：只要任意一端没有明确提出断开连接，则保持TCP连接状态。

**好处**：减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。

**管线化**：能够做到同时并行发送多个请求，不需要一个接一个地等待响应了。

### 使用Cookie的状态管理

Cookie技术通过在请求和响应报文中写入Cookie信息来控制客户端的状态

**原理**：Cookie会根据从服务器端发送的响应报文内一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。下次客户端再往服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送出去。



# 三、HTTP报名内的HTTP信息

用于HTTP协议交互的信息被称为HTTP报文。HTTP报文本身是又多行数据构成的字符串文本。

请求端的HTTP报文叫做请求报文，响应端的报文叫做响应报文。

### 报文首部内容

| 请求行（请求报文）                | 状态行（响应报文）                           | 首部字段                                        | 其他                                        |
| --------------------------------- | -------------------------------------------- | ----------------------------------------------- | ------------------------------------------- |
| 包含请求的方法，请求URI和HTTP版本 | 包含表明响应结果的状态码，原因短语和HTTP版本 | 包含请求和响应的各种条件和属性的各类首部。      | 可能包含HTTP的RFC里未定义的首部（Cookie等） |
|                                   |                                              | 4种首部：通用首部、请求首部、响应首部、实体首部 |                                             |

- 报文（message）是HTTP通信的基本单位，由8位组字节流组成，通过HTTP通信传输。

- 实体（entity）作为请求或响应的有效载荷数据（补充项）被传输。




传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。

实体主体分块的功能称为**分块传输编码**。



# 四、返回结果的HTTP状态码

状态码的作用：当客户端向服务端发送请求，描述返回的请求结果。借助状态码，用户可以知道服务器端是正常处理了请求，还是出现了错误。

状态码的第一位指定了响应的类别，后两位无类别。



|      | 类别                             | 原因短语                   |
| ---- | -------------------------------- | -------------------------- |
| 1    | Informational（信息性状态码）    | 接收的请求正在处理         |
| 2    | Success(成功状态码)              | 请求正常处理完毕           |
| 3    | Redirection（重定向状态码）      | 需要进行附加操作以完成请求 |
| 4    | Client Error（客户端错误状态码） | 服务器无法处理请求         |
| 5    | Server Error（服务器错误状态码） | 服务器处理请求出错         |



| 状态码                | 含义                                                         | 状态码                    | 含义                                                  |
| --------------------- | ------------------------------------------------------------ | ------------------------- | ----------------------------------------------------- |
| 200 OK                | 请求处理正常                                                 | 400 Bad Request           | 表明客户端是发生错误的原因所在                        |
| 204 No Content        | 请求资源成功，但是没有可以返回的资源                         | 401 Unauthorized          | 发送的请求需要有通过HTTP认证的认证信息。              |
| 206 Partial Content   | 设置了请求范围，对资源某一部分的请求                         | 403 Forbidden             | 不允许访问资源                                        |
| 301 Moved Permanently | 永久性重定向，需要进行书签引用 的变更                        | 404 Not Found             | 服务器上没有请求的资源                                |
| 302 Found             | 临时性重定向                                                 | 500 Internal Server Error | 服务器端在执行请求时发生了错误                        |
| 303 See Other         | 由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源 | 503 Service Unavailable   | 服务器暂时处于超负载或正在进行停机 维护，无法处理请求 |
| 304 Not Modified      | 资源已找到，但未符合条件请求                                 | 307 Temporary Redirect    | 临时重定向。和302区别：不会从POST变成GET              |



# 五、与HTTP协作的Web服务器

在同一个IP地址，虚拟主机可以寄存多个不同的主机名和域名，所以在发送HTTP请求的时候，Host首部必须是完整指定主机名或域名的URI

### 通信数据转发程序

|      | 作用                                                       | 特点                                                         | 应用                                                         |
| ---- | ---------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 代理 | 中介，直接转发                                             | 不会改变请求URL，直接发送前方有资源的目标服务器。需要附加Via首部字段以标记出经过的主机信息。 | 缓存代理、透明代理                                           |
| 网关 | 会自己对请求进行处理                                       | 网关能使通信线路上的服务器提供非HTTP协议服务。利用网关能提高通信安全性。 | 连接数据库、在网页购物信用卡结算时，可以和信用卡结算系统联动。 |
| 隧道 | 对两个相隔甚远的客户端和服务器两者之间进行中转保持双方连接 | 目的是确保客户端能与服务器进行安全的通信。                   |                                                              |

### 缓存

缓存：代理服务器或客户端本地磁盘内保存的资源副本。

优势：利用缓存可避免多次从源服务器转发资源。客服端可以就近从缓存服务器上获取资源，而源服务器也不用多次处理相同的请求。



# 六、HTTPS

### HTTP或者是未加密的协议中的缺点：

#### 1.通信使用明文（不加密），内容可能会被窃听

TCP/IP是可能被窃听的网络，通过加密处理防止被窃听。

##### 	（1）通信的加密 

​				HTTP通过和SSL（安全套接层）、TLS(安全传输层协议)组合使用，加密HTTP的通信内容。

​				**与SSL组合使用的HTTP被称为HTTPS（超文本传输协议）**或者HTTP over SSL

##### 	（2）内容的加密

​				把HTTP报文里包含的内容进行加密

​	缺点：1.客户端和服务端同时具备加密和解密机制。

​				2.内容仍然有被修改的风险

#### 2.不验证通信方的身份，因此有可能遭遇伪装

HTTP对于不管是谁发送过来的请求都会接受并作出反应

##### 隐患：

- 无法确定请求发送至目标的web服务器（客户端）是否按真实意图返回响应的那台服务器。有可能是伪装的Web服务器（客户端）。
- 无法确定正在通信的对方是否具备访问权限。有些重要的信息只能发送给特定的用户权限。
- 无法确定请求来自谁。
- 无意义的请求也照单接受，无法组织海量请求下的Dos攻击（拒绝服务攻击）

##### 解决方法：查明对方的证书

​	SSL还可以使用一种证书的手段，用于确定通信方。

​	优点：证明通信方就是意料中的服务器，减少个人信息泄露的危险。

#### 3.无法增明报文完整性，所以有可能已遭篡改

中间人攻击：请求或响应在传输途中，遭攻击者拦截并纂改内容的攻击

如何防止篡改：                 

1.常用的是MD5和SHA-1等散列值校验的方法，以及用来确认文件的数字签名方法。 

缺点：无法百分百保证确认结果是正确的。

2.使用HTTPS。SSL提供认证和加密处理及摘要功能。



### 什么是HTTPS？

#### HTTP+加密+认证+完整性保护=HTTPS                                                                                                                                                                                          

 证书可证明服务器或客户端的身份。

添加了加密以及认证机制的HTTP称为HTTPS（HTTP Secure）

HTTPS其实就是带SSL外壳的HTTP。

HTTP---->应用（HTTP）+ TCP + IP 

HTTPS--->应用（HTTP）+ SSL + TCP + IP   